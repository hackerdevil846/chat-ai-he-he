const axios = require('axios');

module.exports.config = {
    name: "call",
    aliases: ["callbomb", "cbomb"],
    version: "1.0.1",
    author: "ğ´ğ‘ ğ‘–ğ‘“ ğ‘€ğ‘â„ğ‘šğ‘¢ğ‘‘",
    countDown: 30,
    role: 0,
    category: "utility",
    shortDescription: {
        en: "ğ¶ğ‘ğ‘™ğ‘™ ğ‘ğ‘œğ‘šğ‘ğ‘’ğ‘Ÿ (ğ¸ğ‘‘ğ‘¢ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™ ğ‘¢ğ‘ ğ‘’ ğ‘œğ‘›ğ‘™ğ‘¦)"
    },
    longDescription: {
        en: "ğ‘†ğ‘–ğ‘šğ‘¢ğ‘™ğ‘ğ‘¡ğ‘’ğ‘  ğ‘ğ‘ğ‘™ğ‘™ ğ‘ğ‘œğ‘šğ‘ğ‘–ğ‘›ğ‘” ğ‘“ğ‘œğ‘Ÿ ğµğ‘ğ‘›ğ‘”ğ‘™ğ‘ğ‘‘ğ‘’ğ‘ â„ğ‘– ğ‘›ğ‘¢ğ‘šğ‘ğ‘’ğ‘Ÿğ‘ . ğ‘ˆğ‘ ğ‘’ ğ‘Ÿğ‘’ğ‘ ğ‘ğ‘œğ‘›ğ‘ ğ‘–ğ‘ğ‘™ğ‘¦."
    },
    guide: {
        en: "{p}call [01ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥ğ‘¥]"
    },
    dependencies: {
        "axios": ""
    }
};

module.exports.onStart = async function ({ api, event, args }) {
    try {
        const { messageID, threadID } = event;
        const input = args[0];

        // Help message if no input
        if (!input) {
            return api.sendMessage(
                `ğŸ“ ğ¶ğ‘ğ‘™ğ‘™ ğ¶ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ ğ‘ˆğ‘ ğ‘ğ‘”ğ‘’:\nÂ» .call [ğ‘â„ğ‘œğ‘›ğ‘’ ğ‘›ğ‘¢ğ‘šğ‘ğ‘’ğ‘Ÿ]\n\nğ¸ğ‘¥ğ‘ğ‘šğ‘ğ‘™ğ‘’: .call 01712345678\n\nâ„¹ï¸ ğ‘‡â„ğ‘–ğ‘  ğ‘¡ğ‘œğ‘œğ‘™ ğ‘–ğ‘  ğ‘“ğ‘œğ‘Ÿ ğ‘’ğ‘‘ğ‘¢ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™ ğ‘ğ‘¢ğ‘Ÿğ‘ğ‘œğ‘ ğ‘’ğ‘  ğ‘œğ‘›ğ‘™ğ‘¦. ğ‘€ğ‘–ğ‘ ğ‘¢ğ‘ ğ‘’ ğ‘“ğ‘œğ‘Ÿ â„ğ‘ğ‘Ÿğ‘ğ‘ ğ‘ ğ‘šğ‘’ğ‘›ğ‘¡ ğ‘–ğ‘  ğ‘–ğ‘™ğ‘™ğ‘’ğ‘”ğ‘ğ‘™.`,
                threadID,
                messageID
            );
        }

        // Validate Bangladeshi phone number format
        if (!/^01[0-9]{9}$/.test(input)) {
            return api.sendMessage(
                "âŒ ğ¼ğ‘›ğ‘£ğ‘ğ‘™ğ‘–ğ‘‘ ğ‘“ğ‘œğ‘Ÿğ‘šğ‘ğ‘¡! ğ‘ƒğ‘™ğ‘’ğ‘ğ‘ ğ‘’ ğ‘ğ‘Ÿğ‘œğ‘£ğ‘–ğ‘‘ğ‘’ ğ‘ ğ‘£ğ‘ğ‘™ğ‘–ğ‘‘ ğµğ‘ğ‘›ğ‘”ğ‘™ğ‘ğ‘‘ğ‘’ğ‘ â„ğ‘– ğ‘›ğ‘¢ğ‘šğ‘ğ‘’ğ‘Ÿ (11 ğ‘‘ğ‘–ğ‘”ğ‘–ğ‘¡ğ‘  ğ‘ ğ‘¡ğ‘ğ‘Ÿğ‘¡ğ‘–ğ‘›ğ‘” ğ‘¤ğ‘–ğ‘¡â„ '01')\n\nğ¸ğ‘¥ğ‘ğ‘šğ‘ğ‘™ğ‘’: 01712345678",
                threadID,
                messageID
            );
        }

        const processingMsg = await api.sendMessage(
            `ğŸ“ ğ¼ğ‘›ğ‘–ğ‘¡ğ‘–ğ‘ğ‘¡ğ‘–ğ‘›ğ‘” ğ‘ğ‘ğ‘™ğ‘™ ğ‘ ğ‘’ğ‘ğ‘¢ğ‘’ğ‘›ğ‘ğ‘’ ğ‘¡ğ‘œ: ${input}\nâ±ï¸ ğ‘ƒğ‘™ğ‘’ğ‘ğ‘ ğ‘’ ğ‘¤ğ‘ğ‘–ğ‘¡ 90 ğ‘ ğ‘’ğ‘ğ‘œğ‘›ğ‘‘ğ‘ ...\n\nâš ï¸ ğ‘…ğ‘’ğ‘šğ‘–ğ‘›ğ‘‘ğ‘’ğ‘Ÿ: ğ‘ˆğ‘ ğ‘’ ğ‘Ÿğ‘’ğ‘ ğ‘ğ‘œğ‘›ğ‘ ğ‘–ğ‘ğ‘™ğ‘¦. ğ‘ˆğ‘›ğ‘’ğ‘¡â„ğ‘–ğ‘ğ‘ğ‘™ ğ‘¢ğ‘ ğ‘’ ğ‘£ğ‘–ğ‘œğ‘™ğ‘ğ‘¡ğ‘’ğ‘  ğ‘™ğ‘ğ‘¤ğ‘ .`,
            threadID
        );

        // Make API request to call service
        await axios.get(`https://tbblab.shop/callbomber.php?mobile=${input}`);

        // Delete processing message after 90 seconds and send result
        setTimeout(async () => {
            try {
                await api.unsendMessage(processingMsg.messageID);
                api.sendMessage(
                    `âœ… ğ‘†ğ‘¢ğ‘ğ‘ğ‘’ğ‘ ğ‘ ğ‘“ğ‘¢ğ‘™ğ‘™ğ‘¦ ğ‘ğ‘œğ‘šğ‘ğ‘™ğ‘’ğ‘¡ğ‘’ğ‘‘ ğ‘ğ‘ğ‘™ğ‘™ ğ‘ ğ‘’ğ‘ğ‘¢ğ‘’ğ‘›ğ‘ğ‘’ ğ‘¡ğ‘œ: ${input}\n\nğŸ“¢ ğ¸ğ‘‘ğ‘¢ğ‘ğ‘ğ‘¡ğ‘–ğ‘œğ‘›ğ‘ğ‘™ ğ‘Ÿğ‘’ğ‘šğ‘–ğ‘›ğ‘‘ğ‘’ğ‘Ÿ:\nğ‘‡â„ğ‘–ğ‘  ğ‘ ğ‘–ğ‘šğ‘¢ğ‘™ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘‘ğ‘’ğ‘šğ‘œğ‘›ğ‘ ğ‘¡ğ‘Ÿğ‘ğ‘¡ğ‘’ğ‘  ğ‘ ğ‘’ğ‘ğ‘¢ğ‘Ÿğ‘–ğ‘¡ğ‘¦ ğ‘£ğ‘¢ğ‘™ğ‘›ğ‘’ğ‘Ÿğ‘ğ‘ğ‘–ğ‘™ğ‘–ğ‘¡ğ‘–ğ‘’ğ‘ . ğ´ğ‘™ğ‘¤ğ‘ğ‘¦ğ‘  ğ‘Ÿğ‘’ğ‘ ğ‘ğ‘’ğ‘ğ‘¡ ğ‘ğ‘Ÿğ‘–ğ‘£ğ‘ğ‘ğ‘¦ ğ‘™ğ‘ğ‘¤ğ‘  ğ‘ğ‘›ğ‘‘ ğ‘¢ğ‘ ğ‘’ ğ‘˜ğ‘›ğ‘œğ‘¤ğ‘™ğ‘’ğ‘‘ğ‘”ğ‘’ ğ‘’ğ‘¡â„ğ‘–ğ‘ğ‘ğ‘™ğ‘™ğ‘¦.`,
                    threadID,
                    messageID
                );
            } catch (cleanupError) {
                console.error("ğ¶ğ‘™ğ‘’ğ‘ğ‘›ğ‘¢ğ‘ ğ‘’ğ‘Ÿğ‘Ÿğ‘œğ‘Ÿ:", cleanupError);
            }
        }, 90000);

    } catch (error) {
        console.error("ğ¶ğ‘ğ‘™ğ‘™ ğ¶ğ‘œğ‘šğ‘šğ‘ğ‘›ğ‘‘ ğ¸ğ‘Ÿğ‘Ÿğ‘œğ‘Ÿ:", error);
        api.sendMessage(
            `âŒ ğ¹ğ‘ğ‘–ğ‘™ğ‘’ğ‘‘ ğ‘¡ğ‘œ ğ‘–ğ‘›ğ‘–ğ‘¡ğ‘–ğ‘ğ‘¡ğ‘’ ğ‘ğ‘ğ‘™ğ‘™ğ‘ : ${error.message}\n\nğ‘ƒğ‘œğ‘ ğ‘ ğ‘–ğ‘ğ‘™ğ‘’ ğ‘Ÿğ‘’ğ‘ğ‘ ğ‘œğ‘›ğ‘ :\nâ€¢ ğ‘†ğ‘’ğ‘Ÿğ‘£ğ‘–ğ‘ğ‘’ ğ‘¡ğ‘’ğ‘šğ‘ğ‘œğ‘Ÿğ‘ğ‘Ÿğ‘–ğ‘™ğ‘¦ ğ‘¢ğ‘›ğ‘ğ‘£ğ‘ğ‘–ğ‘™ğ‘ğ‘ğ‘™ğ‘’\nâ€¢ ğ¼ğ‘›ğ‘£ğ‘ğ‘™ğ‘–ğ‘‘ ğ‘›ğ‘¢ğ‘šğ‘ğ‘’ğ‘Ÿ ğ‘“ğ‘œğ‘Ÿğ‘šğ‘ğ‘¡\nâ€¢ ğ‘†ğ‘’ğ‘Ÿğ‘£ğ‘’ğ‘Ÿ ğ‘ğ‘œğ‘›ğ‘›ğ‘’ğ‘ğ‘¡ğ‘–ğ‘œğ‘› ğ‘“ğ‘ğ‘–ğ‘™ğ‘’ğ‘‘\n\nğ‘ƒğ‘™ğ‘’ğ‘ğ‘ ğ‘’ ğ‘¡ğ‘Ÿğ‘¦ ğ‘ğ‘”ğ‘ğ‘–ğ‘› ğ‘™ğ‘ğ‘¡ğ‘’ğ‘Ÿ.`,
            event.threadID,
            event.messageID
        );
    }
};
