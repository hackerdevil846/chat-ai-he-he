module.exports.config = {
  name: "natsuki",
  version: "1.0.2",
  hasPermssion: 0,
  credits: "ğ‘¨ğ’”ğ’Šğ’‡ ğ‘´ğ’‚ğ’‰ğ’ğ’–ğ’…",
  description: "ğ’ğ’‚ğ’•ğ’”ğ’–ğ’Œğ’Š ğ’”ğ’‚ğ’•ğ’‰ğ’† ğ’„ğ’–ğ’”ğ’•ğ’ğ’ ğ’‚ğ’—ğ’‚ğ’•ğ’‚ğ’“ ğ’ƒğ’‚ğ’ğ’‚ğ’",
  commandCategory: "ğ’Šğ’ğ’‚ğ’ˆğ’† ğ’„ğ’“ğ’†ğ’‚ğ’•ğ’Šğ’ğ’",
  cooldowns: 5,
  dependencies: {
      "axios": "",
      "fs-extra": "",
      "node-superfetch": ""
  }
};

module.exports.run = async function ({ api, args, event, threads, users }) {
  const axios = global.nodemodule["axios"];
  const fetch = global.nodemodule["node-superfetch"];
  
  if (!args[0]) {
    return api.sendMessage("âš¡ ğ’Œğ’Šğ’„ğ’‰ğ’– ğ’ğ’Šğ’Œğ’‰ğ’–ğ’ ğ’ğ’‚ ğ’‘ğ’ğ’†ğ’‚ğ’”ğ’†!", event.threadID, event.messageID);
  }

  const text = args.join(" ");
  const backgrounds = ["bedroom","class","closet","club","corridor","house","kitchen","residential","sayori_bedroom"];
  const bodies = ["1b","1","2b","2"];
  const faces = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","1t","2bt","2bta","2btb","2btc","2btd","2bte","2btf","2btg","2bth","2bti","2t","2ta","2tb","2tc","2td","2te","2tf","2tg","2th","2ti"];
  
  try {
    const bg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    const body = bodies[Math.floor(Math.random() * bodies.length)];
    const face = faces[Math.floor(Math.random() * faces.length)];
    
    const apiUrl = `https://nekobot.xyz/api/imagegen?type=ddlc&character=natsuki&background=${bg}&body=${body}&face=${face}&text=${encodeURIComponent(text)}`;
    
    const response = await fetch.get(apiUrl);
    const data = response.body;
    
    if (!data.success) {
      return api.sendMessage("âŒ ğ’‚ğ’‘ğ’Š ğ’†ğ’“ğ’“ğ’ğ’“: " + data.message, event.threadID, event.messageID);
    }
    
    const imageUrl = data.message;
    const imageResponse = await fetch.get(imageUrl);
    const imageBuffer = imageResponse.body;
    
    return api.sendMessage({
      body: `ğŸ€ ğ’ğ’‚ğ’•ğ’”ğ’–ğ’Œğ’Š ğ’†ğ’“ ğ’„ğ’‰ğ’ğ’ƒğ’Š ğ’ğ’Šğ’šğ’ ğ’ğ’Šğ’‹ğ’†ğ’“ ğ’‹ğ’ğ’ğ’ğ’ "${text}"`,
      attachment: imageBuffer
    }, event.threadID, event.messageID);
    
  } catch (error) {
    console.error(error);
    return api.sendMessage("âŒ ğ’†ğ’“ğ’“ğ’ğ’“: " + error.message, event.threadID, event.messageID);
  }
};
