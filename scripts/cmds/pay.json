module.exports.config = {
    name: "pay",
    version: "1.0.1",
    hasPermssion: 0,
    credits: "ð‘¨ð’”ð’Šð’‡ ð‘´ð’‚ð’‰ð’Žð’–ð’…",
    description: "ð‘¨ð’ð’šð’†ð’“ ð’Œð’‚ð’„ð’‰ð’† ð’•ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’ð’ð’“ ð’‹ð’ð’ð’ð’ ð’„ð’ð’Žð’Žð’‚ð’ð’…",
    commandCategory: "economy",
    usages: "[ð’•ð’‚ð’ˆ] [ð‘»ð’‚ð’Œð’‚ð’“ ð’”ð’ð’ð’Œð’‰ð’šð’‚]",
    cooldowns: 5
};

module.exports.languages = {
    "vi": {
        "missingTag": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’Œð’† ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’‚ð’“ ð’‹ð’ð’ð’ð’ ð’†ð’Œð’‹ð’ð’ ð’ð’ð’Œð’†ð’“ ð’ð’‚ð’Ž ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’–ð’",
        "overTagLength": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’”ð’–ð’…ð’‰ð’– ð’†ð’Œð’‹ð’ð’ ð’ð’ð’Œð’†ð’“ ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’•ð’† ð’‘ð’‚ð’“ð’ƒð’†ð’",
        "userNotExist": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’‹ð’† ð’ð’ð’Œð’†ð’“ ð’Œð’‚ð’„ð’‰ð’† ð’•ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’•ð’† ð’„ð’‚ð’ð’…ð’†ð’, ð’”ð’† ð’ð’ð’Œð’•ð’Š ð’”ð’Šð’”ð’•ð’†ð’Žð’† ð’ð’†ð’Š",
        "invalidInput": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’†ð’•ð’ ð’•ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’•ð’† ð’‘ð’‚ð’“ð’ƒð’†ð’ ð’ð’‚",
        "payerNotExist": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’†ð’Œð’‰ð’ð’ð’ ð’”ð’Šð’”ð’•ð’†ð’Žð’† ð’ð’†ð’Š, ð’…ð’‚ð’šð’‚ ð’Œð’ð’“ð’† ðŸ“ ð’”ð’†ð’Œð’†ð’ð’… ð’ð’‘ð’†ð’Œð’Œð’‰ð’‚ ð’Œð’ð’“ð’–ð’",
        "notEnoughMoney": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’‚ð’“ ð’Œð’‚ð’„ð’‰ð’† ð’†ð’•ð’ ð’•ð’‚ð’Œð’‚ ð’ð’†ð’Š",
        "paySuccess": "[ ð‘·ð‘¨ð’€ ] %1$ (ðŸðŸ“% ð’•ð’‚ð’™ ð’”ð’ð’‰ð’) ð’•ð’‚ð’Œð’‚ ð’”ð’‚ð’‘ð’‰ð’‚ð’ð’ƒð’‰ð’‚ð’ƒð’† ð’‘ð’‚ð’•ð’‰ð’‚ð’ð’ ð’‰ð’ð’ð’: %2",
        "error": "[ ð‘·ð‘¨ð’€ ] ð‘»ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’ð’ð’“ ð’”ð’ð’Žð’ð’š ð’†ð’Œð’•ð’‚ ð’‘ð’“ð’ð’ƒð’ð’†ð’Ž ð’‰ð’ð’šð’†ð’„ð’‰ð’†"
    },
    "en": {
        "missingTag": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’Œð’† ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’‚ð’“ ð’‹ð’ð’ð’ð’ ð’†ð’Œð’‹ð’ð’ ð’ð’ð’Œð’†ð’“ ð’ð’‚ð’Ž ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’–ð’",
        "overTagLength": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’”ð’–ð’…ð’‰ð’– ð’†ð’Œð’‹ð’ð’ ð’ð’ð’Œð’†ð’“ ð’•ð’‚ð’ˆ ð’Œð’ð’“ð’•ð’† ð’‘ð’‚ð’“ð’ƒð’†ð’",
        "userNotExist": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’‹ð’† ð’ð’ð’Œð’†ð’“ ð’Œð’‚ð’„ð’‰ð’† ð’•ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’•ð’† ð’„ð’‚ð’ð’…ð’†ð’, ð’”ð’† ð’ð’ð’Œð’•ð’Š ð’”ð’Šð’”ð’•ð’†ð’Žð’† ð’ð’†ð’Š",
        "invalidInput": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’†ð’•ð’ ð’•ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’•ð’† ð’‘ð’‚ð’“ð’ƒð’†ð’ ð’ð’‚",
        "payerNotExist": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’Š ð’†ð’Œð’‰ð’ð’ð’ ð’”ð’Šð’”ð’•ð’†ð’Žð’† ð’ð’†ð’Š, ð’…ð’‚ð’šð’‚ ð’Œð’ð’“ð’† ðŸ“ ð’”ð’†ð’Œð’†ð’ð’… ð’ð’‘ð’†ð’Œð’Œð’‰ð’‚ ð’Œð’ð’“ð’–ð’",
        "notEnoughMoney": "[ ð‘·ð‘¨ð’€ ] ð‘¨ð’‘ð’ð’‚ð’“ ð’Œð’‚ð’„ð’‰ð’† ð’†ð’•ð’ ð’•ð’‚ð’Œð’‚ ð’ð’†ð’Š",
        "paySuccess": "[ ð‘·ð‘¨ð’€ ] %1$ (ðŸðŸ“% ð’•ð’‚ð’™ ð’”ð’ð’‰ð’) ð’•ð’‚ð’Œð’‚ ð’”ð’‚ð’‘ð’‰ð’‚ð’ð’ƒð’‰ð’‚ð’ƒð’† ð’‘ð’‚ð’•ð’‰ð’‚ð’ð’ ð’‰ð’ð’ð’: %2",
        "error": "[ ð‘·ð‘¨ð’€ ] ð‘»ð’‚ð’Œð’‚ ð’‘ð’‚ð’•ð’‰ð’‚ð’ð’ð’“ ð’”ð’ð’Žð’ð’š ð’†ð’Œð’•ð’‚ ð’‘ð’“ð’ð’ƒð’ð’†ð’Ž ð’‰ð’ð’šð’†ð’„ð’‰ð’†"
    }
}

module.exports.run = async function ({ api, event, Currencies, Users, args, getText }) {
    const { increaseMoney, decreaseMoney, getData } = Currencies;
    const { threadID, messageID, senderID } = event;
    var targetID = String(args[1]);
    var moneyPay = (args.slice(2, args.length)).join(" ") || null;

    if (isNaN(targetID)) {
        const mention = Object.keys(event.mentions);
        if (mention.length == 0) return api.sendMessage(getText("missingTag"), threadID, messageID);
        if (mention.length > 1) return api.sendMessage(getText("overTagLength"), threadID, messageID);
        args = args.join(" ");
        targetID = String(mention[0]);
        moneyPay = (args.slice(args.indexOf(event.mentions[mention[0]]) + (event.mentions[mention[0]] || "").length + 1, args.length)) || null;
    }

    if (!global.data.allCurrenciesID.includes(targetID)) return api.sendMessage(getText("userNotExist"), threadID, messageID);

    if (isNaN(moneyPay) || moneyPay < 1) return api.sendMessage(getText("invalidInput"), threadID, messageID);
    const taxed = (parseInt(moneyPay) * 15) / 100;
    
    try {
        const moneyPayer = (await getData(senderID)).money;
        if (!moneyPayer) return api.sendMessage(getText("payerNotExist"), threadID, messageID);
        if (moneyPayer < moneyPay) return api.sendMessage(getText("notEnoughMoney"), threadID, messageID);
        const nameTarget = global.data.userName.get(targetID) || await Users.getNameUser(targetID);
        await decreaseMoney(senderID, parseInt(moneyPay));
        await increaseMoney(targetID, parseInt(moneyPay) - taxed);
        return api.sendMessage(getText("paySuccess", (parseInt(moneyPay) - taxed), `${targetID} - ${nameTarget}`), threadID, messageID);
    } catch (e) { 
        console.log(e);
        return api.sendMessage(getText("error"), threadID, messageID) 
    }
}
