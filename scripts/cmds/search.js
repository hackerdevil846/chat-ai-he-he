const fs = require('fs');
const request = require('request'); // ğƒğğ©ğğ§ğğğ§ğœğ² ğ¢ğ¬ ğ¥ğ¢ğ¬ğ­ğğ ğšğ§ğ ğ«ğğªğ®ğ¢ğ«ğğ.

module.exports = {
  config: {
    name: "gsearch", // ğ”ğ¬ğğ ğš ğğ¢ğŸğŸğğ«ğğ§ğ­ ğ§ğšğ¦ğ "ğ ğ¬ğğšğ«ğœğ¡" ğšğ¬ ğ«ğğªğ®ğğ¬ğ­ğğ
    aliases: ["gs", "google", "imgsearch"], // ğ€ğğğğ ğšğ¥ğ¢ğšğ¬ğğ¬ ğšğ¬ ğ«ğğªğ®ğğ¬ğ­ğğ
    version: "1.0.0",
    author: "ğ‘¨ğ’”ğ’Šğ’‡ ğ‘´ğ’‚ğ’‰ğ’ğ’–ğ’…", // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    role: 0, // ğ‚ğ¨ğ§ğ¯ğğ«ğ­ğğ ğŸğ«ğ¨ğ¦ ğ¡ğšğ¬ğğğ«ğ¦ğ¬ğ¬ğ¢ğ¨ğ§: 0
    category: "ğ’Šğ’ğ’‡ğ’", // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    countDown: 5, // ğ‚ğ¨ğ§ğ¯ğğ«ğ­ğğ ğŸğ«ğ¨ğ¦ ğœğ¨ğ¨ğ¥ğğ¨ğ°ğ§ğ¬: 5
    shortDescription: {
      en: "ğ‘®ğ’ğ’ğ’ˆğ’ğ’† ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ’†ğ’ğ’ˆğ’Šğ’ğ’†" // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    },
    longDescription: {
      en: "ğ‘¨ğ’ğ’ğ’ğ’˜ğ’” ğ’šğ’ğ’– ğ’•ğ’ ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ‘®ğ’ğ’ğ’ˆğ’ğ’† ğ’‡ğ’ğ’“ ğ’•ğ’†ğ’™ğ’• ğ’ğ’“ ğ’‘ğ’†ğ’“ğ’‡ğ’ğ’“ğ’ ğ’‚ ğ’“ğ’†ğ’—ğ’†ğ’“ğ’”ğ’† ğ’Šğ’ğ’‚ğ’ˆğ’† ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ’ƒğ’š ğ’“ğ’†ğ’‘ğ’ğ’šğ’Šğ’ğ’ˆ ğ’•ğ’ ğ’‚ğ’ ğ’Šğ’ğ’‚ğ’ˆğ’† ğ’ğ’“ ğ’‘ğ’“ğ’ğ’—ğ’Šğ’…ğ’Šğ’ğ’ˆ ğ’‚ğ’ ğ’Šğ’ğ’‚ğ’ˆğ’† ğ‘¼ğ‘¹ğ‘³." // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    },
    guide: {
      en: "ğ‘¼ğ’”ğ’‚ğ’ˆğ’†: {p}gsearch [ğ’•ğ’†ğ’™ğ’• ğ’•ğ’ ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰]\nğ‘¶ğ’“ ğ’“ğ’†ğ’‘ğ’ğ’š ğ’•ğ’ ğ’‚ğ’ ğ’Šğ’ğ’‚ğ’ˆğ’† ğ’•ğ’ ğ’‘ğ’†ğ’“ğ’‡ğ’ğ’“ğ’ ğ’‚ ğ’“ğ’†ğ’—ğ’†ğ’“ğ’”ğ’† ğ’Šğ’ğ’‚ğ’ˆğ’† ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰. (ğ‘¬ğ’™: {p}gsearch ğ’‘ğ’“ğ’ğ’ˆğ’“ğ’‚ğ’ğ’ğ’Šğ’ğ’ˆ)" // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    },
    priority: 0,
    dependencies: { // ğ€ğğğğ ğğğ©ğğ§ğğğ§ğœğ¢ğğ¬ ğ­ğ¨ ğœğ¨ğ§ğŸğ¢ğ 
      "request": "",
      "fs": "" // ğ€ğğğğ ğŸğ¬ ğ­ğ¨ ğğğ©ğğ§ğğğ§ğœğ¢ğğ¬
    }
  },

  onStart: async function({
    message, // ğ…ğ¨ğ« ğ¬ğğ§ğğ¢ğ§ğ  ğ¦ğğ¬ğ¬ğšğ ğğ¬ (ğ‘ğ„ğğ”ğˆğ‘ğ„ğƒ ğ¢ğ§ ğ†ğ¨ğšğ­ğğ¨ğ­)
    args,    // ğ‚ğ¨ğ¦ğ¦ğšğ§ğ ğšğ«ğ ğ®ğ¦ğğ§ğ­ğ¬ ğšğ«ğ«ğšğ² (ğ‘ğ„ğğ”ğˆğ‘ğ„ğƒ ğ¢ğ§ ğ†ğ¨ğšğ­ğğ¨ğ­)
    event    // ğ„ğ¯ğğ§ğ­ ğğšğ­ğš (ğ¬ğğ§ğğğ«ğˆğƒ, ğ­ğ¡ğ«ğğšğğˆğƒ, ğğ­ğœ. - ğ®ğ¬ğğŸğ®ğ¥ ğŸğ¨ğ« ğ«ğğ©ğ¥ğ¢ğğ¬)
  }) {
    try {
      // ğƒğğ©ğğ§ğğğ§ğœğ² ğœğ¡ğğœğ¤ (ğšğ¬ ğ©ğğ« ğ«ğğªğ®ğğ¬ğ­)
      const { dependencies } = this.config;
      for (const dep in dependencies) {
        try {
          require.resolve(dep);
        } catch (e) {
          console.error(`ğ‘´ğ’Šğ’”ğ’”ğ’Šğ’ğ’ˆ ğ’…ğ’†ğ’‘ğ’†ğ’ğ’…ğ’†ğ’ğ’„ğ’š: ${dep}. ğ‘·ğ’ğ’†ğ’‚ğ’”ğ’† ğ’Šğ’ğ’”ğ’•ğ’‚ğ’ğ’ ğ’Šğ’•.`); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
          return await message.reply(`âŒ ğ‘´ğ’Šğ’”ğ’”ğ’Šğ’ğ’ˆ ğ’…ğ’†ğ’‘ğ’†ğ’ğ’…ğ’†ğ’ğ’„ğ’š: ${dep}. ğ‘·ğ’ğ’†ğ’‚ğ’”ğ’† ğ’Šğ’ğ’”ğ’•ğ’‚ğ’ğ’ ğ’Šğ’• ğ’•ğ’ ğ’–ğ’”ğ’† ğ’•ğ’‰ğ’Šğ’” ğ’„ğ’ğ’ğ’ğ’‚ğ’ğ’….`, event.threadID, event.messageID); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
        }
      }

      let textNeedSearch = "";
      // ğ‘ğğ ğğ± ğ­ğ¨ ğœğ¡ğğœğ¤ ğ¢ğŸ ğ­ğ¡ğ ğ¢ğ§ğ©ğ®ğ­ ğ¢ğ¬ ğš ğğ¢ğ«ğğœğ­ ğ¢ğ¦ğšğ ğ ğ”ğ‘ğ‹ (ğ©ğ§ğ , ğ£ğ©ğ , ğ ğ¢ğŸ)
      const regex = /(https?:\/\/(?:www\.)?(?:[a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}(?:\/[^/?#]*)+(?:\.(?:png|jpe?g|gif))(?:\?(?:[\w_-]+=[\w_-]+)(?:&[\w_-]+=[\w_-]+)*)?(?:#.*)?)/i;

      // ğ‚ğ¡ğğœğ¤ ğ¢ğŸ ğ®ğ¬ğğ« ğ«ğğ©ğ¥ğ¢ğğ ğ­ğ¨ ğšğ§ ğ¢ğ¦ğšğ ğ
      if (event.messageReply && event.messageReply.attachments && event.messageReply.attachments.length > 0 && event.messageReply.attachments[0].type === "Photo") {
        textNeedSearch = event.messageReply.attachments[0].url;
      } else if (args.length === 0) {
        // ğğ¨ ğ«ğğ©ğ¥ğ² ğ­ğ¨ ğ¢ğ¦ğšğ ğ ğšğ§ğ no ğ­ğğ±ğ­ ğ©ğ«ğ¨ğ¯ğ¢ğğğ
        return await message.reply("âŒ ğ‘·ğ’ğ’†ğ’‚ğ’”ğ’† ğ’†ğ’ğ’•ğ’†ğ’“ ğ’”ğ’ğ’ğ’†ğ’•ğ’‰ğ’Šğ’ğ’ˆ ğ’•ğ’ ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ’ğ’“ ğ’“ğ’†ğ’‘ğ’ğ’š ğ’•ğ’ ğ’‚ğ’ ğ’Šğ’ğ’‚ğ’ˆğ’† âŒ"); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
      } else {
        // ğ“ğğ±ğ­ ğ©ğ«ğ¨ğ¯ğ¢ğğğ ğ¢ğ§ ğšğ«ğ ğ®ğ¦ğğ§ğ­ğ¬
        textNeedSearch = args.join(" ");
      }

      // ğˆğŸ ğ¢ğ­'ğ¬ ğšğ§ ğ¢ğ¦ğšğ ğ ğ”ğ‘ğ‹ (ğğ¢ğ­ğ¡ğğ« ğŸğ«ğ¨ğ¦ ğ«ğğ©ğ¥ğ² ğ¨ğ« ğğ¢ğ«ğğœğ­ğ¥ğ² ğ©ğ«ğ¨ğ¯ğ¢ğğğ ğ¢ğ§ ğšğ«ğ ğ¬)
      if (regex.test(textNeedSearch)) {
        const imageUrl = `https://www.google.com/searchbyimage?&image_url=${textNeedSearch}`;
        return await message.reply(`ğŸ” ğ‘°ğ’ğ’‚ğ’ˆğ’† ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ’“ğ’†ğ’”ğ’–ğ’ğ’•: \n${imageUrl}`); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
      } else {
        // ğˆğ­'ğ¬ ğš ğ­ğğ±ğ­ ğ¬ğğšğ«ğœğ¡
        const searchUrl = `https://www.google.com.vn/search?q=${encodeURIComponent(textNeedSearch)}`;
        return await message.reply(`ğŸ” ğ‘ºğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ’“ğ’†ğ’”ğ’–ğ’ğ’• ğ’‡ğ’ğ’“ '${textNeedSearch}': \n${searchUrl}`); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğ’†ğ’ğ’‚ğ’•ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
      }

    } catch (error) {
      console.error("ğ‘ºğ’†ğ’‚ğ’“ğ’„ğ’‰ ğ‘ªğ’ğ’ğ’ğ’‚ğ’ğ’… ğ‘¬ğ’“ğ’“ğ’ğ’“:", error); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğğ¦ğšğ­ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
      await message.reply("âŒ ğ‘¨ğ’ ğ’†ğ’“ğ’“ğ’ğ’“ ğ’ğ’„ğ’„ğ’–ğ’“ğ’“ğ’†ğ’… ğ’˜ğ’‰ğ’Šğ’ğ’† ğ’‘ğ’“ğ’ğ’„ğ’†ğ’”ğ’”ğ’Šğ’ğ’ˆ ğ’šğ’ğ’–ğ’“ ğ’”ğ’†ğ’‚ğ’“ğ’„ğ’‰ âŒ"); // ğ”ğ¬ğğ ğ‘´ğ’‚ğ’•ğ’‰ğğ¦ğšğ­ğ’Šğ’„ğ’‚ğ’ ğğ¨ğ¥ğ ğ‘°ğ’•ğ’‚ğ’ğ’Šğ’„ ğ‘ªğ’‚ğ’‘ğ’Šğ’•ğ’‚ğ’ ğŸğ¨ğ§ğ­
    }
  }
};
