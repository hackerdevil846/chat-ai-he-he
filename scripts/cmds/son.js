module.exports.config = {
    name: "son",
    version: "1.0.0",
    author: "ЁЭСиЁЭТФЁЭТКЁЭТЗ ЁЭС┤ЁЭТВЁЭТЙЁЭТОЁЭТЦЁЭТЕ",
    role: 2,
    category: "automation",
    shortDescription: "ржПржХржЬржиржХрзЗ ржорзЗржирж╢ржи ржХрж░рзЗ рж░рж┐ржкрзНрж▓рж╛ржЗ ржжрж┐рж▓рзЗ ржХрзНрж░ржорж╛ржЧржд ржЧрж╛рж▓рж┐ ржжрж┐ржмрзЗ",
    longDescription: "рждрзБржорж┐ ржХрж╛ржЙржХрзЗ ржорзЗржирж╢ржи ржХрж░рж▓рзЗ, рж╕рзЗ ржпрждржмрж╛рж░ ржорзЗрж╕рзЗржЬ ржжрж┐ржмрзЗ, ржмржЯ ржПржХржЯрж╛рж░ ржкрж░ ржПржХржЯрж╛ ржЧрж╛рж▓рж┐ ржжрж┐ржмрзЗ ржХрзНрж░ржорж╛ржирзБрж╕рж╛рж░рзЗред",
    guide: "{pn} @mention",
    countDown: 3
};

const userResponses = {};

module.exports.onStart = async function ({ api, event }) {
    try {
        const mention = Object.keys(event.mentions)[0];
        if (!mention) {
            return api.sendMessage("тЭМ ржжрзЯрж╛ ржХрж░рзЗ ржПржХржЬржиржХрзЗ ржорзЗржирж╢ржи ржХрж░рзБржи!", event.threadID, event.messageID);
        }

        api.getUserInfo(mention, async (err, userInfo) => {
            if (err) {
                console.error("тЪая╕П Failed to retrieve user information:", err);
                return api.sendMessage("тЭМ ржЗржЙржЬрж╛рж░рзЗрж░ рждржерзНржп ржЖржирждрзЗ ржмрзНржпрж░рзНрже!", event.threadID, event.messageID);
            }

            let genderText;
            switch (userInfo[mention].gender) {
                case 1:
                    genderText = "ржорж╛ржЗржпрж╝рж╛";
                    break;
                case 2:
                    genderText = "ржкрзЛрж▓рж╛";
                    break;
                default:
                    genderText = "рж╣рж┐ржЬржбрж╝рж╛";
            }

            const insults = [
                `ржЦрж╛ржВржХрж┐рж░ ${genderText}, рждрзЛрж░ ржорж╛рж░ ржнрзЛржжрж╛ рждрзЗ ржЧрж╛ржзрж╛рж░ ржорж╛рж▓ ржлрж╛рж▓рж╛ржмрзЛ! ЁЯШИ`,
                `рждрзЛрж░ ржорж╛ ржХрзЗ ржЪрзБржжрзЗ ржЪрзБржжрзЗ ржкрж▓рзНржЯрж┐ ржорж╛рж░ржмрзЛ, ржЧрж╛ржзрж╛рж░ ${genderText}! ЁЯШб`,
                `ржмрж╛ржбрж╝рж┐рж░ ржкрж╛рж╢рзЗ ржорж╛рж▓ ржлрзЗрж▓рзЗ ржжрж┐рзЯрзЗ рждрзЛрж░ ржорж╛ ржХрзЗ ржЪрзБржжрждрзЗ ржЪрж╛ржЗ! ЁЯФе`,
                `рждрзЛрж░ ржорж╛рж░ ржЧрзБржжрзЗ ржлрзБрж▓ ржЯрзНржпрж╛ржмрж▓рзЗржЯ ржкрзБрж╢ ржХрж░рзЗ, ржЧрж╛ржзрж╛рж░ ${genderText}! ЁЯШЫ`,
                `рждрзЛрж░ ржмрзЛржирзЗрж░ ржорзБржЦрзЗ ржорж╛рж▓ ржлрж╛рж▓рж╛ржирзЛрж░ ржХржерж╛ ржнрж╛ржмрж┐, ржорж╛ржЧрзА ${genderText}!`,
                `рждрзЛрж░ ржорж╛рж░ ржнрзЛржжрж╛ржпрж╝ TNT ржврзБржХрж╛ржЗржпрж╝рж╛ ржмрзНрж▓рж╛рж╕рзНржЯ ржХрж░ржмрзЛ! ЁЯТе`,
                `рждрзЛрж░ ржорж╛ ржХрзЗ ржЪрзБржжрзЗ рждрж╛рж░рзЗ ржЧрж░рзНржнржмрждрзА ржмрж╛ржирж╛ржЗ ржжрж┐ржорзБ, рждрзБржЗ рж╣ржмрж┐ ржмрж╛ржЪрзНржЪрж╛! ЁЯС╢`,
                `рждрзЛрж░ ржорж╛рж░ ржЧрзБржжрзЗ рж▓ржЮрзНржЪ ржЪрж▓рж╛ржЗ, рждрзБржЗ рж╣ржмрж┐ ржирж╛ржмрж┐ржХ! ЁЯЫ│я╕П`,
                `рждрзЛрж░ ржЧрж╛рж░рзНрж▓ржлрзНрж░рзЗржирзНржбрж░рзЗ ржЪрзБржжрзЗ рждрзЛрж░ ржкрзНрж░рзЗржо рж╢рзЗрж╖ ржХрж░рзЗ ржжрж┐ржорзБ! ЁЯТФ`,
                `рждрзЛрж░ ржорж╛рзЯрзЗрж░рзЗ ржЪрзБржжрзЗ WiFi ржХрж╛ржирзЗржХрж╢ржи ржирзЗржмрзЛ, рждрзБржЗ рж╣ржмрж┐ router! ЁЯУ╢`,
                `рждрзЛрж░ ржмрзЛржирзЗрж░ ржкрж╛ржЫрж╛ржпрж╝ ржЪржХрж▓рзЗржЯ ржорж╛ржЦрж╛ржЗ, ржЪрж╛ржЯрждрзЗржЫрж┐! ЁЯНл`,
                `рждрзЛрж░ ржорж╛рж░ ржнрзЛржжрж╛ржпрж╝ ржорж╛ржЫ ржЪрж╛рж╖ ржХрж░рждрзЗржЫрж┐, ржЬрж╛рж▓ рждрзБржЗ ржжрж┐рж╕! ЁЯРЯ`,
                `рждрзЛрж░ ржорж╛рж░ ржжрзБржзрзЗ ржжржЗ ржмрж╛ржирж╛ржЗ, ржЪрж╛ржЯрждрзЗржЫрж┐ ржмрж╛ржЯрж┐ рж╕рж╣! ЁЯеЫ`,
                `рждрзЛрж░ рж╣рж┐ржЬржбрж╝рж╛ ржЬрж╛рждрзЗрж░ ${genderText} рж░рзЗ ржЖржорж┐ ржжрзБржЗржмрж╛рж░ ржЪрзБржжрж┐ ржПржХржмрж╛рж░ ржкрзЗржЫржирзЗ! ЁЯМА`,
                `рждрзЛрж░ ржорж╛рж░ ржЧрзБржжрзЗ рж╣рзЗрж▓рж┐ржХржкрзНржЯрж╛рж░ ржирж╛ржорж╛ржЗ, ржШрзБрж░ржкрж╛ржХ ржЦрж╛ржЪрзНржЫрзЗ! ЁЯЪБ`,
                `рждрзЛрж░ ржорж╛ рждрзЛ ржЖржорж╛рж░ ржкрзЗржЯрзЗрж░ ржирж┐ржЪрзЗ рж╣рж╛ржЙржорж╛ржЙ ржХрж░ржЫрзЗ, ржХрж┐ рждрзЛрж░ ржЦржмрж░? ЁЯда`,
                `рждрзЛрж░ ржорж╛рж░ ржорзБржЦрзЗ ржорж╛рж▓ ржлрзЗрж▓рзЗ ржкрзЗржЗржирзНржЯрж┐ржВ ржХрж░рждрзЗржЫрж┐, рждрзБржЗ рж░ржЩ рждрзБрж▓рж┐рж░ ржирж╛ржо рж░рж╛ржЦ! ЁЯОи`,
                `рждрзЛрж░ ржкрзЛрж▓рж╛ржорж╛ржирзБрж╕рзНржХ ${genderText}, рждрзЛрж░ ржЧрзБржжрзЗ ржЖржЩрзНржЧрзБрж▓ ржжрж┐ржпрж╝рж╛ ржмрж╛ржЬрж┐ ржЬрзНржмрж╛рж▓рж╛ржЗ! ЁЯзи`,
                `рждрзЛрж░ ржорж╛рж░ ржЧрзБржжрзЗ рж╕рж╛ржк ржврзБржХрж╛ржЗ ржжрж┐ржЫрж┐, рж╣рзНржпрж╛ржБрж╕рж┐рж▓ ржХрж░ржмрж┐ ржХрзЗржоржирзЗ? ЁЯРН`,
                `рждрзЛрж░ ржмрзЛржирж░рзЗ ржЯрж┐ржнрж┐рждрзЗ рж▓рж╛ржЗржнрзЗ ржЪрзБржжрж┐, рждрзБржЗ рж╣ржмрж┐ ржХрзНржпрж╛ржорзЗрж░рж╛ржорзНржпрж╛ржи! ЁЯУ╕`,
                `рждрзЛрж░ ржорж╛рж░ ржкрж╛ржЫрж╛ржпрж╝ рж╣рж╛рждрзБржбрж╝рж┐ ржжрж┐ржпрж╝рж╛ ржарзЛржХрзНржХрж░ ржорж╛рж░рждрзЗржЫрж┐, рждрзБржЗ рж╣рж╛ржд ржзржЗрж░рж╛ ржзрж░рж┐рж╕! ЁЯФи`,
                `рждрзЛрж░ ржЧрж╛рж▓рж┐рж░ ржнрж╛рж╖рж╛ рж╢рзЗрж╖, ржЖржорж╛рж░ ржЪрзЛржжржирзЗрж░ ржнрж╛рж╖рж╛ рж╢рзБрж░рзБ! ЁЯТп`,
                `рждрзЛрж░ ржорж╛рзЯрзЗрж░ ржнрзЛржжрж╛рзЯ ржлрзНржпрж╛ржи рж▓рж╛ржЧрж╛ржЗржЫрж┐, ржарж╛ржирзНржбрж╛ рж╣ржЗрзЯрж╛ ржЧрзЗржЫрзЗ! ЁЯМА`,
                `рждрзЛрж░ ржмрж╛ржкрзЗрж░ рж╕рж╛ржоржирзЗ рждрзЛрж░ ржорж╛'рж░рзЗ ржЪрзБржжрж┐, ржмрж╛ржк рждрж╛рж▓рж┐ ржмрж╛ржЬрж╛рзЯ! ЁЯСП`,
                `рждрзЛрж░ ржмрзЛржирзЗрж░ ржЧрж╛рж▓рзЗ ржЪрзБржорзБ ржжрзЗржЗ, рждрзБржЗ рж╣рж┐ржВрж╕рзЗ ржХрж░рж┐рж╕! ЁЯШП`,
                `рждрзЛрж░ ржорж╛рж░ ржкрж╛ржЫрж╛рзЯ ржкрзЗржЯрзНрж░рзЛрж▓ ржврзЗрж▓рзЗ ржЖржЧрзБржи рж▓рж╛ржЧрж╛ржЗ, рждрзБржЗ ржжрзМрзЬрж╛рж╕! ЁЯПГтАНтЩВя╕ПЁЯФе`,
                `рждрзЛрж░ рж╣рж┐ржЬрзЬрж╛ ${genderText} ржжрзЗрж╣рзЗ ржмрзЗрж▓рзБржи ржлрж╛ржЯрж╛ржЗ, ржЖржУрзЯрж╛ржЬрзЗ рждрзБржЗ ржнрзЯ ржкрж╛ржЗрж╕! ЁЯОИ`,
                `рждрзЛрж░ ржорж╛рж░ ржЧрзБржжрзЗ ржЪрж┐ржкрж╕ ржЦрж╛ржЗ, рждрзБржЗ ржбрж┐ржк ржЖржирж┐рж╕! ЁЯНЯ`,
                `рждрзЛрж░ ржорж╛рзЯрзЗрж░ ржжрзБржзрзЗ ржЪрж╛ ржмрж╛ржирж╛ржЗ, рждрзБржЗ ржЪрж┐ржирж┐ ржжрж┐рж╕! ЁЯН╡`,
                `рждрзЛрж░ ржмрзЛржирж░рзЗ ржлрзЗрж╕ржмрзБржХрзЗ ржмрзНрж▓ржХ ржжрж┐ржЫрж┐, ржХрж╛рж░ржг ржЪрзБржжрж╛ ржЦрзЗрждрзЗ ржЪрж╛рзЯ! ЁЯЪл`,
                `рждрзЛрж░ ржорж╛рж░ ржнрзЛржжрж╛рзЯ ржкрж┐ржБржкрзЬрж╛ ржврзБржХрж╛ржЗ, ржХрж╛ржорзЬ ржЦрзЗрзЯрзЗ ржирж╛ржЪрзЗ! ЁЯРЬ`,
                `рждрзЛрж░ ржЧрж╛рж░рзНрж▓ржлрзНрж░рзЗржирзНржбрж░рзЗ ржЖржорж╛рж░ ржмрж┐ржЫрж╛ржирж╛рзЯ рж░рж╛ржЦржЫрж┐, рждрзБржЗ ржжрж░ржЬрж╛рзЯ ржкрж╛рж╣рж╛рж░рж╛ ржжрж┐рж╕! ЁЯЪк`
            ];

            userResponses[mention] = { index: 0 };
            api.sendMessage(`ЁЯШЖ ржХрж┐рж░рзЗ ${event.mentions[mention]}! ржХрзЗржоржи ржЖржЫрж┐рж╕..?`, event.threadID, event.messageID);

            const listener = async function (msg) {
                if (msg.senderID === mention && msg.threadID === event.threadID && msg.body) {
                    const idx = userResponses[mention].index;
                    api.sendMessage(insults[idx % insults.length], msg.threadID, msg.messageID);
                    userResponses[mention].index++;
                }
            };

            // Prevent duplicate listeners in the same thread
            if (!global._sonListeners) global._sonListeners = {};
            if (global._sonListeners[event.threadID]) {
                try { global._sonListeners[event.threadID].stop(); } catch (e) {}
            }
            global._sonListeners[event.threadID] = api.listenMqtt(listener);
        });
    } catch (error) {
        console.error("тЪая╕П Command execution error:", error);
        api.sendMessage("тЭМ ржХржорж╛ржирзНржб ржЪрж╛рж▓рж╛рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржпрж╝рзЗржЫрзЗ!", event.threadID, event.messageID);
    }
};
